title: Matrixchat Notifications
author: SpotlightKid
tags:
  - notifications
  - chat
  - matrix
logo: matrix.svg
repo: https://github.com/SpotlightKid/drone-matrixchat-notify
image: https://hub.docker.com/r/spotlightkid/drone-matrixchat-notify
license: MIT License
readme: https://github.com/SpotlightKid/drone-matrixchat-notify/blob/master/README.md
description: >-
  A plugin to send notifications to Matrix chat rooms from CI pipeline steps.
  Supports Jinja message templates and Markdown rendering.
example: |
  kind: pipeline
  type: docker
  name: default

  steps:
  - name: notify
    image: spotlightkid/drone-matrixchat-notify
    settings:
      homeserver: 'https://matrix.org'
      roomid: '!xxxxxx@matrix.org'
      userid: '@drone-bot@matrix.org'
      password:
        from_secret: drone-bot-pw
      markdown: 'yes'
      template: |
        `${DRONE_REPO}` build #${DRONE_BUILD_NUMBER} status: **${DRONE_BUILD_STATUS}**

        ${DRONE_PULL_REQUEST_TITLE}](${DRONE_COMMIT_LINK})
properties:
  roomid:
    type: string
    description: "ID of matrix chat room to send messages to (ID, not alias)."
    secret: false
    required: true
    defaultValue: ""
  userid:
    type: string
    description: "Matrix user ID to send message as (ID, not username)."
    secret: false
    required: true
    defaultValue: ""
  password:
    type: string
    description: |-
      Password to use for authenticating the user set with `userid`.

      Either a password or an access token is required.
    secret: true
    required: true
    defaultValue: ""
  accesstoken:
    type: string
    description: |-
      Access token to use for authentication instead of `password`.

      Either an access token or a password is required.
    secret: true
    required: true
    defaultValue: ""
  allowed_attrs:
    type: array
    defaultValue: "`DEFAULT_ALLOWED_ATTRS`"
    description: >-
      List or string with comma-separated list of HTML attribute names or dict
      mapping tag names to lists of attributes names.
    secret: false
    required: false
  allowed_tags:
    type: array
    defaultValue: "`DEFAULT_ALLOWED_TAGS`"
    description: |-
      List or set or string with comma-separated list of HTML tag names.

      HTML tags not included will be stripped from the HTML output generated by
      rendering a Markdown message template.
    secret: false
    required: false
  deviceid:
    type: string
    description: "Device ID to send with access token."
    secret: false
    required: false
    defaultValue: ""
  devicename:
    type: string
    description: "Device name to send with access token."
    secret: false
    required: false
    defaultValue: ""
  homeserver:
    type: string
    defaultValue: "https://matrix.org"
    description: "The Matrix homeserver URL."
    secret: false
    required: false
  jinja:
    type: boolean
    description: >-
      If set to true, `yes`, `y`, `true`, `t`, `on` or `1`, the message template
      is rendered with the Jinja templating engine.
    secret: false
    required: false
    defaultValue: ""
  markdown:
    type: boolean
    description: >-
      If set to true, `yes`, `y`, `true`, `t`, `on` or `1`, the message
      resulting from template substtution is considered to be in Markdown
      format and will be rendered to HTML.
    secret: false
    required: false
    defaultValue: ""
  pass_environment:
    type: array
    defaultValue: "DRONE_*"
    description: |-
      Comma-separated white-list of environment variable names or name
      shell-glob patterns.

      Only environment variables matching any of the given names or patterns
      will be available as valid placeholders in the message template.
    secret: false
    required: false
  markdown_extensions:
    type: array
    defaultValue: "admonition, extra, sane_lists, smarty"
    description: "Comma-separated list of enabled Markdown extensions."
    secret: false
    required: false
  template:
    type: string
    defaultValue: "${DRONE_BUILD_STATUS}"
    description: |-
      The message template.

      Valid placeholders (example: `${DRONE_REPO}`) will be substituted with the
      values of the matching environment variables (subject to filtering
      according to the `pass_environment` setting).
    secret: false
    required: false
